generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================================
// EMPRESAS ASSOCIADAS
// ============================================================

model Empresa {
  id          Int      @id @default(autoincrement())
  empresa     String   @db.VarChar(255)
  texto       String?  @db.Text
  coord       String?  @db.VarChar(255)
  user        String?  @db.VarChar(100)
  senha       String?  @db.VarChar(255)
  ativo       String   @default("n") @db.Char(1)
  foto        String?  @db.VarChar(255)
  construtora String?  @db.Char(1)

  pontos    Ponto[]
  showroom  Showroom[]
  promocoes Promocao[]

  @@map("empresas")
}

// ============================================================
// ESCRITÓRIOS
// ============================================================

model Escritorio {
  id               Int     @id @default(autoincrement())
  ativo            String  @default("n") @db.Char(1)
  empresa          String? @db.VarChar(255)
  nome_fantasia    String? @db.VarChar(255)
  endereco         String? @db.VarChar(255)
  cep              String? @db.VarChar(10)
  bairro           String? @db.VarChar(255)
  cidade           String? @db.VarChar(255)
  estado           String? @db.VarChar(5)
  complemento      String? @db.VarChar(255)
  telefone         String? @db.VarChar(30)
  celular          String? @db.VarChar(30)
  email            String? @db.VarChar(255)
  fax              String? @db.VarChar(30)
  cnpj             String? @db.VarChar(255)
  nome_contato     String? @db.VarChar(255)
  funcao           String? @db.VarChar(255)
  email_contato    String? @db.VarChar(255)
  telefone_contato String? @db.VarChar(30)
  celular_contato  String? @db.VarChar(30)
  usuario          String? @db.VarChar(255)
  senha            String? @db.VarChar(255)
  site             String? @db.VarChar(255)

  @@map("escritorios")
}

// ============================================================
// PROFISSIONAIS
// ============================================================

model Profissional {
  id                Int     @id @default(autoincrement())
  ativo             String  @default("n") @db.Char(1)
  nome              String? @db.VarChar(255)
  usuario           String? @db.VarChar(255)
  senha             String? @db.VarChar(255)
  datanascimento    String? @db.VarChar(20)
  telefone          String? @db.VarChar(30)
  celular           String? @db.VarChar(30)
  endereco          String? @db.VarChar(255)
  bairro            String? @db.VarChar(255)
  cidade            String? @db.VarChar(255)
  uf                String? @db.VarChar(5)
  complemento       String? @db.VarChar(255)
  crea              String? @db.VarChar(255)
  email             String? @db.VarChar(255)
  site              String? @db.VarChar(255)
  empresa           String? @db.VarChar(255)
  end_empresa       String? @db.VarChar(255)
  bairro_empresa    String? @db.VarChar(255)
  cidade_uf_empresa String? @db.VarChar(255)
  telefone_empresa  String? @db.VarChar(30)
  cpf               String? @db.VarChar(20)

  @@map("profissionais")
}

// ============================================================
// PONTUAÇÃO / FIDELIDADE
// ============================================================

model Ponto {
  id              Int       @id @default(autoincrement())
  id_profissional Int?
  tipo            String?   @db.VarChar(254)
  id_empresa      Int?
  valor           Float?
  pontos          Decimal?  @db.Decimal(10, 0)
  estagio_obra    String?   @db.VarChar(254)
  cidade          String?   @db.VarChar(254)
  telefone        String?   @db.VarChar(254)
  email           String?   @db.VarChar(255)
  ativo           String?   @default("a") @db.Char(1)
  status          String?   @db.VarChar(5)
  nota            String?   @db.VarChar(254)
  data            DateTime? @default(now()) @db.Timestamp(0)

  empresaRel Empresa? @relation(fields: [id_empresa], references: [id])

  @@map("pontos")
}

// ============================================================
// LOG DE ALTERAÇÕES DE PONTOS
// ============================================================

model LogPonto {
  id             Int       @id @default(autoincrement())
  ponto_id       Int
  acao           String    @db.VarChar(20) // EDITAR, EXCLUIR
  dados_anterior String?   @db.Text        // JSON com dados antes da alteração
  dados_novo     String?   @db.Text        // JSON com dados após alteração
  usuario_id     Int?
  usuario_nome   String?   @db.VarChar(255)
  created_at     DateTime  @default(now()) @db.Timestamp(0)

  @@map("log_pontos")
}

// ============================================================
// TABELA DE MULTIPLICADORES DE BÔNUS (Índice por empresas únicas/mês)
// ============================================================

model BonusMultiplier {
  id            Int      @id @default(autoincrement())
  range_min     Int
  range_max     Int?     // NULL = sem limite superior (ex: 20+)
  multiplier    Decimal  @db.Decimal(4, 2)
  bonus_percent Int      @default(0)

  @@map("bonus_multipliers")
}

// ============================================================
// SHOWROOM & PROMOÇÕES
// ============================================================

model Showroom {
  id        Int     @id @default(autoincrement())
  descricao String? @db.Text
  empresa   Int?
  foto      String? @db.VarChar(255)

  empresaRel Empresa? @relation(fields: [empresa], references: [id])

  @@map("showroom")
}

model Promocao {
  id      Int     @id @default(autoincrement())
  titulo  String? @db.VarChar(255)
  texto   String? @db.Text
  empresa Int?
  foto    String? @db.VarChar(255)

  empresaRel Empresa? @relation(fields: [empresa], references: [id])

  @@map("promocao")
}

// ============================================================
// NOTÍCIAS
// ============================================================

model Noticia {
  id     Int       @id @default(autoincrement())
  titulo String?   @db.VarChar(255)
  texto  String?   @db.Text
  data   DateTime? @db.Date

  fotos FotoNoticia[]

  @@map("noticias")
}

model FotoNoticia {
  id        Int     @id @default(autoincrement())
  descricao String? @db.Text
  id_evento Int?
  capa      String? @db.Char(1)
  foto      String? @db.VarChar(255)

  noticia Noticia? @relation(fields: [id_evento], references: [id])

  @@map("fotos_noticias")
}

// ============================================================
// INFORMATIVOS
// ============================================================

model Informativo {
  id_informativo  Int       @id @default(autoincrement())
  id_empresa      Int?
  titulo          String?   @db.VarChar(255)
  descricao       String?   @db.Text
  data            DateTime? @db.Date
  id_visualizacao String?   @db.Text

  fotos InformativoFoto[]

  @@map("mod_informativo")
}

model InformativoFoto {
  id_informativo_f Int     @id @default(autoincrement())
  legenda          String? @db.VarChar(255)
  id_informativo   Int?
  capa             String? @db.Char(1)
  imagem           String? @db.VarChar(255)

  informativo Informativo? @relation(fields: [id_informativo], references: [id_informativo])

  @@map("mod_informativo_f")
}

// ============================================================
// ÍNDICE DE CONVERSÃO
// ============================================================

model Indice {
  id_indice Int     @id @default(autoincrement())
  indice    String? @db.VarChar(20)

  @@map("mod_indice")
}

// ============================================================
// ADMIN (CAS)
// ============================================================

model CasUsuario {
  usuario_id    Int     @id @default(autoincrement())
  usuario_nome  String? @db.VarChar(255)
  usuario_user  String? @db.VarChar(100)
  usuario_senha String? @db.VarChar(255)
  usuario_tipo  String? @db.VarChar(10)

  acessos CasAcessoMod[]
  logs    CasLogAcesso[]

  @@map("cas_usuarios")
}

model CasModulo {
  modulo_id          Int       @id @default(autoincrement())
  modulo_nome        String?   @db.VarChar(255)
  modulo_nivel       String?   @db.VarChar(10)
  modulo_atualizacao DateTime? @db.Timestamp(0)

  acessos CasAcessoMod[]

  @@map("cas_modulos")
}

model CasAcessoMod {
  usuario_id         Int
  modulo_id          Int
  acesso_atualizacao DateTime? @db.Timestamp(0)

  usuario CasUsuario @relation(fields: [usuario_id], references: [usuario_id])
  modulo  CasModulo  @relation(fields: [modulo_id], references: [modulo_id])

  @@id([usuario_id, modulo_id])
  @@map("cas_acessos_mod")
}

model CasLogAcesso {
  log_acesso_id      Int       @id @default(autoincrement())
  log_acesso_usuario Int?
  log_acesso_login   DateTime? @db.Timestamp(0)
  log_acesso_logout  DateTime? @db.Timestamp(0)
  log_acesso_IP      String?   @db.VarChar(45)

  usuario CasUsuario? @relation(fields: [log_acesso_usuario], references: [usuario_id])

  @@map("cas_log_acessos")
}

// ============================================================
// CONFIGURAÇÕES DO SISTEMA
// ============================================================

model Configuracao {
  id        Int       @id @default(autoincrement())
  chave     String    @unique @db.VarChar(100)
  valor     String    @db.VarChar(255)
  descricao String?   @db.VarChar(255)
  updated_at DateTime? @default(now()) @updatedAt @db.Timestamp(0)

  @@map("configuracoes")
}

// ============================================================
// LOG DE ALTERAÇÕES DE CONFIGURAÇÕES
// ============================================================

model LogConfiguracao {
  id             Int       @id @default(autoincrement())
  chave          String    @db.VarChar(100)
  valor_anterior String?   @db.VarChar(255)
  valor_novo     String    @db.VarChar(255)
  usuario_id     Int?
  usuario_nome   String?   @db.VarChar(255)
  created_at     DateTime  @default(now()) @db.Timestamp(0)

  @@map("log_configuracoes")
}
